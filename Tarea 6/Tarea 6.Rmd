---
title: Análisis de Datos I <br> Tarea 6
author:
  - "Maria Carolina Navarro Monge C05513"
  - "Tábata Picado Carmona C05961"
  - "Jose Pablo Trejos Conejo C07862"
output:
  rmdformats::robobook:
        code_folding: show
  html_document:
    toc: TRUE
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Librerías

```{r, warning=FALSE, message=FALSE}
library(FactoMineR)
library(factoextra)
```

# Ejercicio 1

**La siguiente tabla representa el tipo de estudios cursados (universitarios, cursos preparatorios, otros) según el tipo bachillerato cursado (A-Literatura, B-Economía, C-Ciencias (matemáticas, física), D-Ciencias naturales (biología, química,...).**

Primero se confecciona la tabla a partir de los datos suministrados en el documento de la tarea 6:
```{r}
T_contingencia <- matrix(c(13,2,5,20,20,2,8,30,10,5,5,20,7,1,22,30,50,10,40,100), byrow = T, nrow = 5, ncol = 4, 
            dimnames = list(c("A", "B", "C", "D","Total"), c("Univ.", "Prepa.", "Otros","Total")))
T_contingencia
```
Ahora se crea la tabla de frecuencias:
```{r}
T_frec_relativas <- T_contingencia/100 
dimnames(T_frec_relativas) <- list(c("A", "B", "C", "D","frec. r columna"), 
                                c("Univ.", "Prepa.", "Otros","frec. r fila"))
T_frec_relativas
```

## a) Encuentre la tabla de efectivos teorica suponiendo independencia.

Para esto, primero calculamos la tabla de *Frecuencias Teóricas* considerando que el elemento en la fila $i$, columna $j$, corresponde al calculo de:

$$f_{i \bullet} \cdot f_{\bullet j}$$

Entonces:
```{r}
generar_tabla_efectivos <- function(tabla){
  resultado <- tabla
  
  n_fil <- nrow(tabla)
  n_col <- ncol(tabla)
    
  for(i in 1:(n_fil - 1)){
    for(j in 1:(n_col - 1)){
      resultado[i,j] <- tabla[i,n_col]*tabla[n_fil,j]
    }
  }
  
  return(resultado)
}

T_frec_teoricas <- generar_tabla_efectivos(T_frec_relativas)
T_frec_teoricas
```

Finalmente, multiplicando por el total de individuos la matriz anterior, obtenemos la tabla de efectivos teóricos.
```{r}
T_efec_teoricos <- 100*T_frec_teoricas
T_efec_teoricos
```

## b) Calcular la distancia de $\chi^{2}$ entre la tabla de contingencia real y la tabla de efectivos teorica en caso de independencia.

Para este calculo se recurre a la formula:

$$\chi^{2} = n\sum_{i=1}^{m_{1}} \sum_{j=1}^{m_{2}} \dfrac{(f_{ij} - f_{i \bullet} f_{\bullet j})^{2}}{f_{i \bullet} f_{\bullet j}}$$

```{r}
calcular_distancia <- function(tabla){
  resultado <- 0
  
  n_fil <- nrow(tabla)
  n_col <- ncol(tabla)
    
  for(i in 1:(n_fil - 1)){
    for(j in 1:(n_col - 1)){
      aux <- tabla[i,n_col]*tabla[n_fil,j]
      resultado <- resultado + ((tabla[i,j] - aux)**2)/aux
    }
  }
  
  resultado <- 100*resultado
  
  return(resultado)  
}

distancia_chi <- calcular_distancia(T_frec_relativas)
distancia_chi
```

## c) Calcule la matriz X de perfiles de fila y la matriz Y de perfiles de columna.

Para esto, se crearán dos funciones que calcules las matrices $X$ e $Y$.
```{r}
perfiles_fila <- function(tabla){
  resultado <- tabla
  
  n_fil <- nrow(tabla)
  n_col <- ncol(tabla)
    
  for(i in 1:(n_fil - 1)){
    for(j in 1:(n_col - 1)){
      resultado[i,j] <- resultado[i,j]/tabla[i,n_col]
    }
  }
  
  return(resultado)
}

perfiles_columna <- function(tabla){
  resultado <- tabla
  
  n_fil <- nrow(tabla)
  n_col <- ncol(tabla)
    
  for(i in 1:(n_fil - 1)){
    for(j in 1:(n_col - 1)){
      resultado[i,j] <- resultado[i,j]/tabla[n_fil,j]
    }
  }
  
  return(resultado)
}

X <- perfiles_fila(T_frec_relativas)
Y <- perfiles_columna(T_frec_relativas)

X
Y
```

# Ejercicio 2

<img src="Teorema 6.jpeg">

# Ejercicio 3

**3. El código abajo ilustra como construir una Tabla Cruzada en R a partir de una tabla Individuos × Variables. Explique en detalle cada línea del siguiente código y luego con la tabla resultante ejecute un AFC e interprete los resultados:**

Se carga la librería MASS, la cual se utiliza para estimar modelos lineales generalizados mixtos por medio de métodos de cuasi-verosimilitud penalizados (PQL).

```{r, warning=FALSE, message=FALSE}
library(MASS)
```

La función head() retorna la primera parte del dataframe Cars93.

```{r}
head(Cars93)
```

La función table() utiliza factores de clasificación cruzada para crear una tabla de contingecia. En este caso las columnas Type y DriveTrain son las que deben ser utilizadas como factores para la creación de la tabla cruzada. El resultado se guarda en la variable datos. 

```{r}
datos <- table(Cars93$Type, Cars93$DriveTrain)
```

Se imprime la variable datos, la cual muestra la frecuencia de ocurrencia de cada combinación posible de valores entre las variables Type y DriveTrain.

```{r}
datos
```

La función class() obtiene qué clase posee el objeto datos. En este caso es de tipo table. 

```{r}
class(datos)
```

La función unclass() se encarga de convertir el objeto datos que era de tipo table en una lista sin ninguna clase específica. 

```{r}
datos <- unclass(datos)
```

Se obtiene la clase del objeto datos. En este caso puede ser matrix o array. 

```{r}
class(datos)
```

Con la función as.data.frame() se convierte el objeto datos en uno de tipo data.frame

```{r}
datos <- as.data.frame(datos)
```

Se obtiene la clase del objeto datos. En este caso data.frame debido a la función aplicada anteriormente.

```{r}
class(datos)
```

Se imprime la variable datos. 

```{r}
datos
```

Ahora vamos a ejecutar un AFC con la tabla cruzada resultante. 

```{r}
AFC_datos <- CA(datos, graph = F)
AFC_datos
```

## Porcentaje de varianza explicada
```{r}
fviz_screeplot(AFC_datos, addlabels = TRUE)
```
Como se puede observar el mayor porecentaje de varianza explicada como es de esperase viene dado por la dimensión 1. En total si se toman en cuenta las dos dimensiones se tiene un porcentaje de varianza explicada del 100%. 

## Biplot
```{r}
fviz_ca_biplot(AFC_datos, repel = TRUE)
```

Analizando el gráfico de individuos y variables se puede notar que los automóviles que poseen tracción delantera son los pequeños, compactos y medianos. Los de tracción trasera son los deportivos y grandes. Por último, los vehículos que poseen doble tracción son las camionetas. 

## Cosenos cuadrados para filas 
```{r}
fviz_cos2(AFC_datos, choice = "row", axes = 1:2)
```

## Cosenos cuadrados para columnas 
```{r}
fviz_cos2(AFC_datos, choice = "col", axes = 1:2)
```

Tanto en el gráfico de cosenos cuadrados de filas como de columnas todos los individios y variables están completamente bien representados ya que su coseno cuadrado es igual a 1.

## Contribuciones para las filas 
```{r}
fviz_ca_row(AFC_datos, col.row = "contrib", 
            gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"), 
            repel = TRUE)
```

Para las filas se tiene que el individuo con mayor contribución es el vehículo de tipo camioneta y el de menor de tipo compacto, los demás poseen contribuciones similares.   

## Contribuciones para las columnas
```{r}
fviz_ca_col(AFC_datos, col.col = "contrib",
            gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
            repel = TRUE)
```

En el lado de las variables la que posee mayor contribución es la de doble tracción, seguidamente tracción trasera y por último, la tracción delantera. 

